import * as chai from 'chai';
import nock from 'nock';
import { ACClient } from '../../src';
import {
  EMWSInventoryResult,
  ESKUVaultAvailableQuantityResult,
  MWSInfoRequestWithMarketplace,
  SKUsRequest,
  SKUsResult
} from '../../src/ac/constant/constant';

const expect = chai.expect;

describe('Request tests', () => {
  before(function() {
    nock.cleanAll();
  });

  let acClient: ACClient;
  const origin = 'https://api.ac.app.channelprecision.com';
  beforeEach(function() {
    acClient = new ACClient({
      baseUrl: origin,
      clientId: '5d02d21a-9933-4666-817c-800c9956dafc'
    });
  });
  it('get SKUs', async () => {
    const SKUs: SKUsRequest = {
      type: 'ASIN',
      ids: ['B00517B0F6'],
    };
    nock(origin).get(`/v1/skus?type=ASIN&ids=B00517B0F6`)
    .reply(200, {
      "items": [
        {
          "id": "B00517B0F6",
          "id_type": "ASIN",
          "sku": "HG-41114957524_79_34-32"
        }
      ],
      "invalid_items": []
    });
    const result:SKUsResult = await acClient.getSKUs(SKUs);
    expect(result.items[0].sku).to.equal("HG-41114957524_79_34-32");
  });
  it('get Sku Vault Quantity', async () => {
    const params: MWSInfoRequestWithMarketplace = {
      item_type: 'UPC',
      item_ids: ['012998179378'],
    };
    nock(origin).get(`/v1/skuvault/available-quantity?marketplace=amazon.com&id_type=UPC&ids=012998179378`)
      .reply(200, {
        "items": [
          {
            "code": "PLOYSJGUG",
            "upc": "012998179378",
            "sku": "TSK-3001840_9.5-M",
            "available_quantity": 15,
            "held_quantity": 2,
            "pending_quantity": 3,
            "picked_quantity": 5,
            "total_on_hand": 1
          }
        ],
        "invalid_items": []
      });
    const result: ESKUVaultAvailableQuantityResult = await acClient.getSKUVaultInventory(params);
    expect(result.items[0].upc).to.equal("012998179378");
  });
  it('get Sku Vault Quantity', async () => {
    const params: MWSInfoRequestWithMarketplace = {
      item_type: 'UPC',
      item_ids: ['012998179378'],
    };
    nock(origin).get(`${acClient.URI_SKU_VAULT_INVENTORY}?marketplace=amazon.com&id_type=UPC&ids=012998179378`)
      .reply(200, {
        "items": [
          {
            "code": "PLOYSJGUG",
            "upc": "012998179378",
            "sku": "TSK-3001840_9.5-M",
            "available_quantity": 15,
            "held_quantity": 2,
            "pending_quantity": 3,
            "picked_quantity": 5,
            "total_on_hand": 1
          }
        ],
        "invalid_items": []
      });
    const result: ESKUVaultAvailableQuantityResult = await acClient.getSKUVaultInventory(params);
    expect(result.items[0].upc).to.equal("012998179378");
  });
  it('get MWS Inventory', async () => {
    const params: MWSInfoRequestWithMarketplace = {
      item_type: 'ASIN',
      item_ids: ['B07BR6ZQH8'],
    };
    nock(origin).get(`${acClient.MWS_INVENTORY}?marketplace=ATVPDKIKX0DER&id_type=ASIN&ids=B07BR6ZQH8`)
      .reply(200, {
        "items": [
          {
            "asin": "B07BR6ZQH8",
            "sku": "TSK-3001840_9.5-M",
            "fba": 9,
            "mfn": 2
          }
        ],
        "invalid_items": []
      });
    const result: EMWSInventoryResult = await acClient.getMWSInventory(params);
    expect(result.items[0].asin).to.equal("B07BR6ZQH8");
  });
});
