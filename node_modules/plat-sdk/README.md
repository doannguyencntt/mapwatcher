# plat-sdk

SDK for whole platform.

# Install
## Add private registry
npm set registry http://npm-registry.channelprecision.com
## Install package
npm install plat-sdk
### Should install by command:
npm install plat-sdk@`<version>` --registry http://npm-registry.channelprecision.com/
### EX:
npm install plat-sdk@1.0.0-qa1 --registry http://npm-registry.channelprecision.com/

# Usage
## AC Service
```javascript
// import module
import { ACClient, UPCsRequest, UPCsResult, SKUsRequest, SKUsResult, AWSVariantsRequest, AWSVariantsResult, MWSInfoRequest, MWSInfoResult, MWSProductVariantsRequest, MWSProductVariantsResult, AmzBuyboxCachedRequest, AmzBuyboxCachedResult } from 'plat-sdk';

// create instance
let baseUrl = 'https://api.ac.app.channelprecision.com/'
let clientId = 'your client id'
let acClient = new ACClient({
    baseUrl, clientId
})

// Example
// 1. Get UPCs
let UPCs: UPCsRequest = {
    type: string | 'ASIN', // ASIN -- just ASIN for now
    ids: string[] // allow up to 1000 items
}
acClient.getUPCs(UPCs).then((result: UPCsResult) => {
    // use the result
}).catch(console.error)
// Here is how a UPCsResult object look like
UPCsResult = {
    items: [
        {
            asin: string,
            parent_asin: string,
            upc: string,
            brand: string,
            ean: string,
        }
    ],
    not_found_items: string[] // value of asin, upc, brand or ean
}

// 2. Get SKUs
let SKUs: SKUsRequest = {
    type: string, // ASIN, UPC, EAN
    ids: string[] // allow up to 1000 items
}
acClient.getSKUs(SKUs).then((result: SKUsResult) => {
    // use the result
}).catch(console.error)
// Here is how a SKUsResult object look like
SKUsResult = {
    items: [
        {
            id: string,
            type: string,
            sku: string
        }
    ],
    invalid_items: [
        {
            id: string,
            type: string,
            code: 404,
            message: string, // 'Not found'
        }
    ]
}

// 3. Get product info from aws
let Variants: AWSVariantsRequest = {
    item_type: string, // ASIN, UPC, EAN
    use_cache: boolean | true, // optional, default true
    item_ids: string[], // does not allow > 10 items
}
acClient.getAWSInfo(Variants).then((result: AWSVariantsResult) => {
    // use the result
}).catch(console.error)
// Here is how a AWSVariantsResult object look like
AWSVariantsResult = {
    items: [
        {
            asin: string,
            parent_asin: string,
            upc: string,
            brand: string,
            title: string,
            ean: string,
        }
    ],
    invalid_items: string[], // array of invalid items
    not_cached_items: string[],
    data_from: string | 'cache', // 'cache', 'latest'
}

// 4. Get product variant from aws
// The Request and result object like with #3.
acClient.getAWSVariants(Variants).then((result: AWSVariantsResult) => {
    // use the result
}).catch(console.error)

// 5. Get product details from MWS endpoints
let MWSInfo: MWSInfoRequest = {
    item_type: string, // ASIN, SellerSKU, UPC, EAN
    item_ids: string[] // ID, max five
}
acClient.getMWSInfo(MWSInfo).then((result: MWSInfoResult) => {
    // use the result
}).catch(console.error)
// Here is how a MWSInfoResult object look like
MWSInfoResult = [
    {
        items: {
            brand: string,
            title: string,
            asin: string,
            parent_asin: string,
            upc: string,
            ean: string,
            sku: string,
            color: string,
            size: string,
            standalone: string, // Stand-alone, Parented, PageNotFound
            item_width: {
                value: number | 0,
                units: string,
            },
            item_height: {
                value: number | 0,
                units: string,
            },
            item_length: {
                value: number | 0,
                units: string,
            },
            item_weight: {
                value: number | 0,
                units: string,
            },
            package_width: {
                value: number | 0,
                units: string,
            },
            package_height: {
                value: number | 0,
                units: string,
            },
            package_length: {
                value: number | 0,
                units: string,
            },
            package_weight: {
                value: number | 0,
                units: string,
            },
            sales_rank: [
                {
                    product_category_id: string,
                    rank: number | 0,
                }
            ]
        }
    ]
}

// 6. Get product variants from MWS endpoints
let MWSProductVariants: MWSProductVariantsRequest = {
    item_type: string | 'ASIN', // ASIN, SellerSKU, UPC, EAN
    item_ids: string[], // ID, max five
    use_cache: boolean | true // optional, default true
}
acClient.getMWSVariants(MWSProductVariants).then((result: MWSProductVariantsResult) => {
    // use the result
}).catch(console.error)
// Here is how a MWSProductVariantsResult object look like
MWSProductVariantsResult =  {
    items: [
        {
            asin: string,
            parent_asin: string | null, // default null
            upc: string | null, // default null, get it from asin -> UPC if not available from MWS
            brand: string | null, // default null
            title: string | null, // default null
            ean: string | null // default null, get it from asin -> UPC if not available from MWS
        }
    ],
    invalid_items: string[], // array of invalid items
    not_cached_items: string[],
    data_from: string | 'cache', // 'cache', 'latest'
}

// 7. Get cached amazon buybox sellers
let AmzBuyboxCached: AmzBuyboxCachedRequest = {
    item_type: string | 'ASIN', // ASIN -- just ASIN for now
    item_ids: string[], // does not allow > 10 items
    use_cache: boolean | true
}
acClient.getCachedAmazonSellers(AmzBuyboxCached).then((result: AmzBuyboxCachedResult) => {
    // use the result
}).catch(console.error)
// Here is how a AmzBuyboxCachedResult object look like
AmzBuyboxCachedResult = {
    items: [
        {
            id: string,
            price: number | 0,
            inventory: number | 0,
            condition: string,
            is_fba: boolean | true,
            is_prime: boolean | true,
            created: string,
            updated: string,
            asin: {
                id: string,
                asin: string,
                sku: string,
                upc: string,
                title: string,
                brand_id: string,
                created: string,
                updated: string
            },
            brand: {
                id: string,
                name: string
            },
            seller: {
                id: string,
                name: string,
                merchant_id: string
            }
        }
    ],
    invalid_items: string[],
    not_cached_items: string[]
}

// 8. Get cached amazon product reviews
let AmzProductReviews: AmzProductReviewsRequest = {
    item_type: string | 'ASIN', // ASIN -- just ASIN for now
    item_ids: string[], // does not allow > 10 items
    use_cache: boolean | true
}
acClient.getCachedProductReviews(AmzProductReviews).then((result: AmzProductReviewsResult) => {
    // use the result
}).catch(console.error)
// Here is how a AmzProductReviewsResult object look like
AmzProductReviewsResult = {
    items: [
        {
            all_format: { // often for the parent asin
                total_reviews: number,
                total_positive_reviews: number,
                total_critical_reviews: number,
                star_average: number,
                star_percent_5: number,
                star_percent_4: number,
                star_percent_3: number,
                star_percent_2: number,
                star_percent_1: number,
            },
            current_format: {
                asin_timeline: string, // get from the input asin_timeline
                total_reviews: number, // for the current child asin
                last_1: { // object of null
                    days: number,
                    reviews: number,
                },
                last_2: {
                    days: number,
                    reviews: number,
                },
                last_3: {
                    days: number,
                    reviews: number,
                }
            }
        }
    ],
    invalid_items: string[], // array of invalid items (e.g asin)
    not_cached_items: string[] // list item not found from cache, they need to call CS API for that values
}
```
## Portal Service
```javascript
// import module
import { PSClient, ActivityCreate, ActivityRequest, ActivityList, Activity, UserActivity, DataAction } from 'plat-sdk';

// create instance
let baseUrl = 'http://portal-api.dev.channelprecision.com/'
let token = 'token'
let psClient = new PSClient({
    baseUrl, token
})

// Example
// 1. Create Activity
let payload: ActivityCreate = {
  action: string, // ActionType
  object_id: string, // organization_id, client_id
  object_type: string, // ObjectType: organization, client
  data: DataAction
}
let data: DataAction = {
  app_profile: string,
  module: string,
  client_id: string,
  client_name: string,
  report_id: string | null,
  report_name: string | null
}

psClient.createActivity(payload).then((result: Activity) => {
    // use the result
}).catch(console.error)
// Here is how a Activity object look like
Activity = {
  id: string,
  user: UserActivity,
  action: string, // ActionType
  action_label: string;
  object_id: string,
  object_type: string, // ObjectType
  data: DataAction | null, // DataAction
  created: string
}
UserActivity = {
  user_id: string,
  first_name: string,
  last_name: string,
  email: string,
  enabled: boolean | true,
  username: string,
  avatar: string | ""
}

// 2. Get list activities
let payload: ActivityRequest = {
  action: string | null, // ActionType
  key: string | null,
  page: number | null,
  limit: number | null,
}
psClient.getActivities(payload).then((result: ActivityList) => {
    // use the result
}).catch(console.error)
// Here is how a ActivityList object look like
ActivityList = {
  count: number,
  next: string | null,
  previous: string | null,
  results: Activity[]
}

// 3. Get Activity detail
psClient.getActivityDetail(activityId: string).then((result: Activity) => {
    // use the result
}).catch(console.error)

```
## Data Source
```javascript
// import module
import { StaticExpression, DSClient, CreateClientRequest,
  CreateClientResult, ICreateDataSourceAndSchema, CreateDataSourceResult, GetDataSourceResult, CreateDataSourceSchemaResult, ICreateDataSource , ICreateDataSourceSchema
  IUpdateDataSourceAndSchema, UpdateDataSourceResult, UpdateDataSourceSchemaResult, UploadFileToDataSourceRequest, IUpdateDataSource, IUpdateDataSourceSchema
  UploadFileToDataSourceResult, ImportJsonToDataSourceRequest, ImportJsonToDataSourceResult
 } from 'plat-sdk';

// create instance
let baseUrl = 'http://ds-api.dev.channelprecision.com/'
let clientId = 'your client id'
let dsClient = new DSClient({
    baseUrl, clientId
})

// Example
// 1. StaticExpression
// Check expression
let expression = '' // date or name function ( TODAY() )
if (StaticExpression.isValid(expression)) {   // check already expression
    // handler Expression
    StaticExpression.eval(expression)
}

//2. Create Client
let payload : CreateClientRequest = {
  clienId: string; // ClientId
  name: string;   // name Client
}
DSClient.createClient(payload).then((result: CreateClientResult) => {
    // use the result
}).catch(console.error)

//3. Get Data Source
let id = '' //idDataSource
DSClient.getDataSource(id).then((result: GetDataSourceResult) => {
    // use the result
}).catch(console.error)

//4. create Data Source
let data: ICreateDataSourceAndSchema = {
        cols: {
            name: string;
            label: string;
            type: string;
        } [],
        indexes?: {
            type: string;
            cols: string[];
        }[];
    } |null; = {
  dataSource: {
    external_id: string,
    client_id: string,
    name: string,
    description: string,
    type: string,
    config: {}
  };
  dataSchema: {
        cols: {
            name: string;
            label: string;
            type: string;
        } [],
        indexes?: {
            type: string;
            cols: string[];
        }[];
  } |null;
}
DSClient.createDataSource(data).then((result: {dataSource: CreateDataSourceResult, dataSourceSchema?:CreateDataSourceSchemaResult}) => {
    // use the result
}).catch(console.error)

//5. Update Data Source
let data: IUpdateDataSourceAndSchema = {
    id: string,
    dataSource: {
        id: string, 
        external_id: string,
        client_id: string,
        name: string,
        description: string,
        type: string,
        config: {}
    };
    dataSchema: {
        cols: {
            name: string;
            label: string;
            type: string;
        } [],
        indexes?: {
            type: string;
            cols: string[];
        }[];
    } |null;
}
DSClient.updateDataSource(data).then((result: UpdateDataSourceResult | UpdateDataSourceSchemaResult) => {
    // use the result
}).catch(console.error)

//6. Upload File To Data Source

let formData = new FormData()
formData.append('file', fileData) // fileData: File Csv Or Excel in local
let payload : UploadFileToDataSourceRequest = {
  id: string;                     //idDataSource
  localCsvOrExcelFilePath: formData;
}
DSClient.uploadFileToDataSource(payload).then((result: UploadFileToDataSourceResult) => {
    // use the result
}).catch(console.error)

//7. Upload Json To Data Source
let requestImport : ImportJsonToDataSourceRequest = {
  id: string;
  override: boolean;
  data: any[];  // json format
}
DSClient.importJsonToDataSource(payload).then((result: ImportJsonToDataSourceResult) => {
    // use the result
}).catch(console.error)

```
## Reporting App
```javascript
// import module
import {RAClient, CreateWidgetRequest, WidgetResultInterface} from 'plat-sdk';

// create instance
let baseUrl = 'http://ra-api.dev.channelprecision.com/';
let token = '{token}';
let raApiToken = '{raApiToken config}';
let RAClient = new RAClient({
    baseUrl, token, raApiToken
});

//1. Create Client
let widgetRequest : CreateWidgetRequest = {
  params: {
    client_id: string;
  };
  payload: {
    ds_id: string;
    cf_id: string;
    cf_object: object;
    name: string;
  };
}
RAClient.createWidget(widgetRequest).then((result: WidgetResultInterface) => {
    // use the result
}).catch(console.error);

//2. Create dashboard
let dashboardRequest : CreateDashboardRequest = {
  params: {
    client_id: string
  };
  payload: {
    cf_object: object;
    name: string;
    description: string;
  };
}
RAClient.createDashboard(dashboardRequest).then((result: DashboardResultInterface) => {
    // use the result
}).catch(console.error);

//3. share mode
let sharedDashboardInterface : SharedDashboardInterface = {
  params: {
    client_id: string
  };
  payload: {
    shared_users: Array<{
      das_id: string,
      user_email: string,
      permission: string
    }>
  };
}
RAClient.sharedDashboard(sharedDashboardInterface).then((result: any) => {
    // use the result
}).catch(console.error);
