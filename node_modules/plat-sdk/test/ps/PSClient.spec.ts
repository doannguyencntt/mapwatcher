import * as chai from 'chai';
import nock from 'nock';
import { PSClient } from '../../src';
import { ActivityRequest } from '../../src/ps/constant/constant';

const expect = chai.expect;

describe('Request tests', () => {
  before(function() {
    nock.cleanAll();
  });

  let psClient: PSClient;
  const origin = 'http://portal-api.dev.channelprecision.com/';
  beforeEach(function() {
    psClient = new PSClient({
      baseUrl: origin,
      token: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VyX2lkIjoiNGZkMGQ1ZWUtZjZjOC00MjNjLTlhZGYtYmE3NGQwMGJmZjA1IiwidXNlcm5hbWUiOiJ0YWkucGhhbUBoZHdlYnNvZnQuY28iLCJleHAiOjE1ODIxNzk1NjUsImVtYWlsIjoidGFpLnBoYW1AaGR3ZWJzb2Z0LmNvIiwib3JpZ19pYXQiOjE1ODIwMDY3NjUsImFwcCI6Im13cnciLCJmbmFtZSI6IlRhaSIsImxuYW1lIjoiUGhhbSBWYW4ifQ.ksnaFnk4JJaVaKdTZObNzYjH9LD5NZb6kcEEUp3JWMSAovtuq4aIxtXjh0ZiOdD3aD7HQLbhOUasTzKYvOb6wYH0lt9lL7YeZw8LZollcZoJ0MIaBxO-MsevXpH4cntcfIewx1AC4_vmZ0Q96jgDbkxEEjAbzKEOfog-KfxlIR5EX-hFcKBbYvXa3DBzJAPUg_ZPLLIAPj_XthxpPKuFfWHsYg7OTQRFI-sOyq9w0GaTINwgV-h3KnlqHwaN-6F1RkwnCF1cp30Ft1WbK7WUkdN8-oKgKJDv3Tlt0DZDcsgz4Lt8hwsuURprCWe0VRn9i-To3Ai8XeXSTw_O25OKBw'
    });
  });
  it('get Activities', async () => {
    const activityRequest: ActivityRequest = {
      page: 1,
      limit: 1
    };
    nock(origin).get(`/v1/activities/?page=1&limit=1`)
    .reply(200, {
      results: [
        {
          "id": "b77d5227-9e33-4597-b321-9e2430bc9fa8"
        }
      ]
    });
    return await psClient.getActivities(activityRequest)
    .then(res => res.results[0].id)
    .then(res => expect(res).to.equal("b77d5227-9e33-4597-b321-9e2430bc9fa8"));
  });
});
